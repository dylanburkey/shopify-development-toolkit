---
import Dashboard from '../../../layouts/Dashboard.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const sections = await getCollection('sections');
  return sections.map((section) => ({
    params: { slug: section.data.slug },
    props: { section },
  }));
}

const { section } = Astro.props;

// Generate Liquid schema from section data
function generateLiquidSchema(sectionData: typeof section.data) {
  const schema = {
    name: sectionData.name,
    settings: sectionData.settings,
    blocks: sectionData.blocks,
    max_blocks: sectionData.maxBlocks,
    presets: sectionData.presets,
  };
  return JSON.stringify(schema, null, 2);
}

const liquidSchema = generateLiquidSchema(section.data);
---

<Dashboard title={section.data.name} activeNav="sections">
  <div class="mb-6">
    <a href="/library/sections" class="inline-flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700 mb-4">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      Back to Sections
    </a>

    <div class="flex items-start justify-between">
      <div>
        <div class="flex items-center gap-3 mb-2">
          <h1 class="text-2xl font-bold text-gray-900">{section.data.name}</h1>
          <span class="px-2 py-1 text-xs bg-purple-100 text-purple-700 rounded-full capitalize">{section.data.category}</span>
        </div>
        <p class="text-gray-600">{section.data.description || 'No description'}</p>
      </div>
      <button class="px-4 py-2 bg-emerald-600 text-white rounded-lg font-medium hover:bg-emerald-700 transition-colors">
        Add to Project
      </button>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Preview Panel -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
      <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-lg font-semibold text-gray-900">Preview</h2>
      </div>
      <div class="h-64 bg-gradient-to-br from-gray-100 to-gray-50 flex items-center justify-center">
        <div class="text-center">
          <svg class="w-16 h-16 text-gray-300 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6z" />
          </svg>
          <p class="text-gray-400">Preview coming soon</p>
        </div>
      </div>
    </div>

    <!-- Settings Panel -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
      <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-lg font-semibold text-gray-900">Settings ({section.data.settings.length})</h2>
      </div>
      <div class="divide-y divide-gray-100 max-h-64 overflow-y-auto">
        {section.data.settings.map((setting) => (
          <div class="px-6 py-3">
            <div class="flex items-center justify-between">
              <div>
                <p class="font-medium text-gray-900">{setting.label}</p>
                <p class="text-sm text-gray-500">{setting.id}</p>
              </div>
              <span class="px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded font-mono">{setting.type}</span>
            </div>
          </div>
        ))}
      </div>
    </div>
  </div>

  <!-- Liquid Schema Code -->
  <div class="mt-6 bg-white rounded-xl shadow-sm border border-gray-200">
    <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
      <h2 class="text-lg font-semibold text-gray-900">Liquid Schema</h2>
      <button
        onclick="navigator.clipboard.writeText(document.getElementById('schema-code').textContent)"
        class="text-sm text-emerald-600 hover:text-emerald-700 font-medium"
      >
        Copy
      </button>
    </div>
    <div class="p-6">
      <pre id="schema-code" class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code>{`{% schema %}\n${liquidSchema}\n{% endschema %}`}</code></pre>
    </div>
  </div>

  <!-- Usage in Projects -->
  <div class="mt-6 bg-white rounded-xl shadow-sm border border-gray-200">
    <div class="px-6 py-4 border-b border-gray-200">
      <h2 class="text-lg font-semibold text-gray-900">Used in Projects</h2>
    </div>
    <div class="p-6 text-center text-gray-500">
      <p>Not used in any projects yet.</p>
    </div>
  </div>
</Dashboard>
